import{r as p,j as y}from"./jsx-runtime-D2HyDbKh.js";import{b as xe,L as ee,H as De,d as Q,g as Re,I as Oe}from"./components--oc4anGP.js";const Le="modulepreload",Ne=function(e){return"https://cdn.shopify.com/oxygen-v2/33621/23113/47952/664951/"+e},te={},Ue=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.all(r.map(a=>{if(a=Ne(a),a in te)return;te[a]=!0;const c=a.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${d}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":Le,c||(u.as="script",u.crossOrigin=""),u.href=a,s&&u.setAttribute("nonce",s),document.head.appendChild(u),c)return new Promise((l,m)=>{u.addEventListener("load",l),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})}))}return o.then(()=>t()).catch(i=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i})};function R(e){if(!e){const t=`flattenConnection(): needs a 'connection' to flatten, but received '${e??""}' instead.`;return console.error(t+" Returning an empty array"),[]}return"nodes"in e?e.nodes:"edges"in e&&Array.isArray(e.edges)?e.edges.map(t=>{if(!(t!=null&&t.node))throw new Error("flattenConnection(): Connection edges must contain nodes");return t.node}):[]}const O="_shopify_y",L="_shopify_s";var Ve=new Set(["domain","path","max-age","expires","samesite","secure","httponly"]);function $e(e){let t={},r,n,o=0,i=e.split(/;\s*/g),s,a;for(;o<i.length;o++)if(n=i[o],r=n.indexOf("="),~r){if(s=n.substring(0,r++).trim(),a=n.substring(r).trim(),a[0]==='"'&&(a=a.substring(1,a.length-1)),~a.indexOf("%"))try{a=decodeURIComponent(a)}catch{}Ve.has(n=s.toLowerCase())?n==="expires"?t.expires=new Date(a):n==="max-age"?t.maxage=+a:t[n]=a:t[s]=a}else(s=n.trim().toLowerCase())&&(s==="httponly"||s==="secure")&&(t[s]=!0);return t}function Me(e,t,r={}){let n=e+"="+encodeURIComponent(t);return r.expires&&(n+="; Expires="+new Date(r.expires).toUTCString()),r.maxage!=null&&r.maxage>=0&&(n+="; Max-Age="+(r.maxage|0)),r.domain&&(n+="; Domain="+r.domain),r.path&&(n+="; Path="+r.path),r.samesite&&(n+="; SameSite="+r.samesite),(r.secure||r.samesite==="None")&&(n+="; Secure"),r.httponly&&(n+="; HttpOnly"),n}const re="xxxx-4xxx-xxxx-xxxxxxxxxxxx";function z(){let e="";try{const t=window.crypto,r=new Uint16Array(31);t.getRandomValues(r);let n=0;e=re.replace(/[x]/g,o=>{const i=r[n]%16,s=o==="x"?i:i&3|8;return n++,s.toString(16)}).toUpperCase()}catch{e=re.replace(/[x]/g,r=>{const n=Math.random()*16|0;return(r==="x"?n:n&3|8).toString(16)}).toUpperCase()}return`${qe()}-${e}`}function qe(){let e=0,t=0;e=new Date().getTime()>>>0;try{t=performance.now()>>>0}catch{t=0}return Math.abs(e+t).toString(16).toLowerCase().padStart(8,"0")}function ve(e){const t=$e(e);return{[O]:t[O]||"",[L]:t[L]||""}}const E={PAGE_VIEW:"PAGE_VIEW",ADD_TO_CART:"ADD_TO_CART",PAGE_VIEW_2:"PAGE_VIEW_2",COLLECTION_VIEW:"COLLECTION_VIEW",PRODUCT_VIEW:"PRODUCT_VIEW",SEARCH_VIEW:"SEARCH_VIEW"},N={article:"article",blog:"blog",captcha:"captcha",cart:"cart",collection:"collection",customersAccount:"customers/account",customersActivateAccount:"customers/activate_account",customersAddresses:"customers/addresses",customersLogin:"customers/login",customersOrder:"customers/order",customersRegister:"customers/register",customersResetPassword:"customers/reset_password",giftCard:"gift_card",home:"index",listCollections:"list-collections",forbidden:"403",notFound:"404",page:"page",password:"password",product:"product",policy:"policy",search:"search"},We={hydrogen:"hydrogen",headless:"headless"},ne={hydrogen:"6167201",headless:"12875497473"};function I(e,t){return{schema_id:e,payload:t,metadata:{event_created_at_ms:Date.now()}}}function T(e){const t={id:"",resource:null,resourceId:null,search:"",searchParams:new URLSearchParams,hash:""};if(typeof e!="string")return t;try{const{search:r,searchParams:n,pathname:o,hash:i}=new URL(e),s=o.split("/"),a=s[s.length-1],c=s[s.length-2];return!a||!c?t:{id:`${a}${r}${i}`||"",resource:c??null,resourceId:a||null,search:r,searchParams:n,hash:i}}catch{return t}}function w(e,t){return typeof e!="object"?{}:(Object.entries(e).forEach(([r,n])=>{n&&(t[r]=n)}),t)}function je(e){return typeof document>"u"?(console.error(`${e} should only be used within the useEffect callback or event handlers`),!0):!1}const Ge="trekkie_storefront_page_view/1.4",He="myshopify.dev";function oe(e){const t=e,{id:r,resource:n}=T(t.resourceId),o=n?n.toLowerCase():void 0;return[I(Ge,w({pageType:t.pageType,customerId:parseInt(T(t.customerId).id||"0"),resourceType:o,resourceId:parseInt(r)},Be(t)))]}function Be(e){return{appClientId:e.shopifySalesChannel?ne[e.shopifySalesChannel]:ne.headless,isMerchantRequest:Fe(e.url),hydrogenSubchannelId:e.storefrontId||"0",isPersistentCookie:e.hasUserConsent,uniqToken:e.uniqueToken,visitToken:e.visitToken,microSessionId:z(),microSessionCount:1,url:e.url,path:e.path,search:e.search,referrer:e.referrer,title:e.title,shopId:parseInt(T(e.shopId).id),currency:e.currency,contentLanguage:e.acceptedLanguage||"en"}}function Fe(e){if(typeof e!="string")return!1;const t=new URL(e).hostname;return t.indexOf(He)!==-1||t==="localhost"}const A="custom_storefront_customer_tracking/1.0",_e="page_rendered",Ce="collection_page_rendered",Pe="product_page_rendered",Je="product_added_to_cart",Ee="search_submitted";function W(e){return{canonical_url:e.canonicalUrl||e.url,customer_id:parseInt(T(e.customerId).id||"0")}}function Ye(e){const t=e,r=W(t),n=t.pageType,o=[];switch(o.push(I(A,w({event_name:_e,...r},S(t)))),n){case N.collection:o.push(I(A,w({event_name:Ce,...r,collection_name:t.collectionHandle},S(t))));break;case N.product:o.push(I(A,w({event_name:Pe,...r,products:Z(t.products),total_value:t.totalValue},S(t))));break;case N.search:o.push(I(A,w({event_name:Ee,...r,search_string:t.searchString},S(t))));break}return o}function ze(e){const t=e,r=W(t);return[I(A,w({event_name:_e,...r},S(t)))]}function Ke(e){const t=e,r=W(t);return[I(A,w({event_name:Ce,...r,collection_name:t.collectionHandle},S(t)))]}function Qe(e){const t=e,r=W(t);return[I(A,w({event_name:Pe,...r,products:Z(t.products),total_value:t.totalValue},S(t)))]}function Ze(e){const t=e,r=W(t);return[I(A,w({event_name:Ee,...r,search_string:t.searchString},S(t)))]}function Xe(e){const t=e,r=T(t.cartId),n=r!=null&&r.id?`${r.id}`:null;return[I(A,w({event_name:Je,customerId:t.customerId,cart_token:n,total_value:t.totalValue,products:Z(t.products),customer_id:parseInt(T(t.customerId).id||"0")},S(t)))]}function S(e){return{source:e.shopifySalesChannel||We.headless,hydrogenSubchannelId:e.storefrontId||"0",is_persistent_cookie:e.hasUserConsent,ccpa_enforced:!1,gdpr_enforced:!1,unique_token:e.uniqueToken,event_time:Date.now(),event_id:z(),event_source_url:e.url,referrer:e.referrer,user_agent:e.userAgent,navigation_type:e.navigationType,navigation_api:e.navigationApi,shop_id:parseInt(T(e.shopId).id),currency:e.currency}}function Z(e){return e?e.map(t=>{const r=w({variant_gid:t.variantGid,category:t.category,sku:t.sku,product_id:parseInt(T(t.productGid).id),variant_id:parseInt(T(t.variantGid).id)},{product_gid:t.productGid,name:t.name,variant:t.variantName||"",brand:t.brand,price:parseFloat(t.price),quantity:Number(t.quantity||0)});return JSON.stringify(r)}):[]}function j(e,t){const{eventName:r,payload:n}=e;if(!n.hasUserConsent)return Promise.resolve();let o=[];const i=n;return r===E.PAGE_VIEW?o=o.concat(oe(i),Ye(i)):r===E.ADD_TO_CART?o=o.concat(Xe(n)):r===E.PAGE_VIEW_2?o=o.concat(oe(i),ze(i)):r===E.COLLECTION_VIEW?o=o.concat(Ke(i)):r===E.PRODUCT_VIEW?o=o.concat(Qe(i)):r===E.SEARCH_VIEW&&(o=o.concat(Ze(i))),o.length?et(o,t):Promise.resolve()}const ae="sendShopifyAnalytics request is unsuccessful";function et(e,t){const r={events:e,metadata:{event_sent_at_ms:Date.now()}};try{return fetch(t?`https://${t}/.well-known/shopify/monorail/unstable/produce_batch`:"https://monorail-edge.shopifysvc.com/unstable/produce_batch",{method:"post",headers:{"content-type":"text/plain"},body:JSON.stringify(r)}).then(n=>{if(!n.ok)throw new Error("Response failed");return n.text()}).then(n=>{n&&JSON.parse(n).result.forEach(i=>{i.status!==200&&console.error(ae,`

`,i.message)})}).catch(n=>{console.error(ae,n)})}catch{return Promise.resolve()}}function tt(){if(je("getClientBrowserParameters"))return{uniqueToken:"",visitToken:"",url:"",path:"",search:"",referrer:"",title:"",userAgent:"",navigationType:"",navigationApi:""};const[e,t]=ot(),r=ve(document.cookie);return{uniqueToken:r[O],visitToken:r[L],url:location.href,path:location.pathname,search:location.search,referrer:document.referrer,title:document.title,userAgent:navigator.userAgent,navigationType:e,navigationApi:t}}function rt(){try{const e=(performance==null?void 0:performance.getEntriesByType)&&(performance==null?void 0:performance.getEntriesByType("navigation"));if(e&&e[0]){const t=window.performance.getEntriesByType("navigation")[0].type;return t&&t.toString()}}catch{}}function nt(){var e,t;try{if(PerformanceNavigation&&((e=performance==null?void 0:performance.navigation)==null?void 0:e.type)!==null&&((t=performance==null?void 0:performance.navigation)==null?void 0:t.type)!==void 0){const r=performance.navigation.type;switch(r){case PerformanceNavigation.TYPE_NAVIGATE:return"navigate";case PerformanceNavigation.TYPE_RELOAD:return"reload";case PerformanceNavigation.TYPE_BACK_FORWARD:return"back_forward";default:return`unknown: ${r}`}}}catch{}}function ot(){try{let e="PerformanceNavigationTiming",t=rt();return t||(t=nt(),e="performance.navigation"),t?[t,e]:["unknown","unknown"]}catch{}return["error","error"]}const se={};function at(e,t){const r=se[e];if(r)return r;const n=new Promise((o,i)=>{const s=document.createElement("script");t!=null&&t.module?s.type="module":s.type="text/javascript",s.src=e,s.onload=()=>{o(!0)},s.onerror=()=>{i(!1)},(t==null?void 0:t.in)==="head"?document.head.appendChild(s):document.body.appendChild(s);const a=t==null?void 0:t.attributes;a&&Object.keys(a).forEach(c=>{s.setAttribute(c,a[c])})});return se[e]=n,n}function st(e,t){const[r,n]=p.useState("loading");return p.useEffect(()=>{at(e,t).then(()=>n("done")).catch(()=>n("error"))},[e]),r}const it=60*60*24*360*1,ct=60*30;function ut(e){const{hasUserConsent:t=!1,domain:r="",checkoutDomain:n=""}=e||{};p.useEffect(()=>{const o=ve(document.cookie);let i=r||window.document.location.host;if(n){const a=n.split(".").reverse(),c=i.split(".").reverse(),d=[];a.forEach((u,l)=>{u===c[l]&&d.push(u)}),i=d.reverse().join(".")}/^localhost/.test(i)&&(i="");const s=i?/^\./.test(i)?i:`.${i}`:"";t?(H(O,o[O]||z(),it,s),H(L,o[L]||z(),ct,s)):(H(O,"",0,s),H(L,"",0,s))},[e,t,r,n])}function H(e,t,r,n){document.cookie=Me(e,t,{maxage:r,domain:n,samesite:"Lax",path:"/"})}var ie=new Set,dt=e=>{ie.has(e)||(console.warn(e),ie.add(e))},ce=new Set,ue=e=>{ce.has(e)||(console.error(new Error(e)),ce.add(e))};p.lazy(()=>Ue(()=>import("./log-seo-tags-TY72EQWZ-DCHH-_Gl.js"),[]));function Wt({connection:e,children:t=()=>(console.warn("<Pagination> requires children to work properly"),null)}){let r=xe().state==="loading",{endCursor:n,hasNextPage:o,hasPreviousPage:i,nextPageUrl:s,nodes:a,previousPageUrl:c,startCursor:d}=lt(e),u=p.useMemo(()=>({pageInfo:{endCursor:n,hasPreviousPage:i,hasNextPage:o,startCursor:d},nodes:a}),[n,o,i,d,a]),l=p.useMemo(()=>p.forwardRef(function(h,f){return o?p.createElement(ee,{preventScrollReset:!0,...h,to:s,state:u,replace:!0,ref:f}):null}),[o,s,u]),m=p.useMemo(()=>p.forwardRef(function(h,f){return i?p.createElement(ee,{preventScrollReset:!0,...h,to:c,state:u,replace:!0,ref:f}):null}),[i,c,u]);return t({state:u,hasNextPage:o,hasPreviousPage:i,isLoading:r,nextPageUrl:s,nodes:a,previousPageUrl:c,NextLink:l,PreviousLink:m})}function B(e){let t=new URLSearchParams(e);return t.delete("cursor"),t.delete("direction"),t.toString()}function $(e){throw new Error(`The Pagination component requires ${"`"+e+"`"} to be a part of your query. See the guide on how to setup your query to include ${"`"+e+"`"}: https://shopify.dev/docs/custom-storefronts/hydrogen/data-fetching/pagination#setup-the-paginated-query`)}function lt(e){e.pageInfo||$("pageInfo"),typeof e.pageInfo.startCursor>"u"&&$("pageInfo.startCursor"),typeof e.pageInfo.endCursor>"u"&&$("pageInfo.endCursor"),typeof e.pageInfo.hasNextPage>"u"&&$("pageInfo.hasNextPage"),typeof e.pageInfo.hasPreviousPage>"u"&&$("pageInfo.hasPreviousPage");let t=De(),{state:r,search:n,pathname:o}=Q(),i=new URLSearchParams(n).get("direction")==="previous",s=p.useMemo(()=>{var l;return!((l=globalThis==null?void 0:globalThis.window)!=null&&l.__hydrogenHydrated)||!r||!(r!=null&&r.nodes)?R(e):i?[...R(e),...r.nodes]:[...r.nodes,...R(e)]},[r,e]),a=p.useMemo(()=>{var _,C,v,P,V;let l=(_=globalThis==null?void 0:globalThis.window)==null?void 0:_.__hydrogenHydrated,m=!l||((C=r==null?void 0:r.pageInfo)==null?void 0:C.startCursor)===void 0?e.pageInfo.startCursor:r.pageInfo.startCursor,h=!l||((v=r==null?void 0:r.pageInfo)==null?void 0:v.endCursor)===void 0?e.pageInfo.endCursor:r.pageInfo.endCursor,f=!l||((P=r==null?void 0:r.pageInfo)==null?void 0:P.hasPreviousPage)===void 0?e.pageInfo.hasPreviousPage:r.pageInfo.hasPreviousPage,g=!l||((V=r==null?void 0:r.pageInfo)==null?void 0:V.hasNextPage)===void 0?e.pageInfo.hasNextPage:r.pageInfo.hasNextPage;return r!=null&&r.nodes&&(i?(m=e.pageInfo.startCursor,f=e.pageInfo.hasPreviousPage):(h=e.pageInfo.endCursor,g=e.pageInfo.hasNextPage)),{startCursor:m,endCursor:h,hasPreviousPage:f,hasNextPage:g}},[i,r,e.pageInfo.hasNextPage,e.pageInfo.hasPreviousPage,e.pageInfo.startCursor,e.pageInfo.endCursor]),c=p.useRef({params:B(n),pathname:o});p.useEffect(()=>{window.__hydrogenHydrated=!0},[]),p.useEffect(()=>{(B(n)!==c.current.params||o!==c.current.pathname)&&(c.current={pathname:o,params:B(n)},t(`${o}?${B(n)}`,{replace:!0,preventScrollReset:!0,state:{nodes:void 0,pageInfo:void 0}}))},[o,n]);let d=p.useMemo(()=>{let l=new URLSearchParams(n);return l.set("direction","previous"),a.startCursor&&l.set("cursor",a.startCursor),`?${l.toString()}`},[n,a.startCursor]),u=p.useMemo(()=>{let l=new URLSearchParams(n);return l.set("direction","next"),a.endCursor&&l.set("cursor",a.endCursor),`?${l.toString()}`},[n,a.endCursor]);return{...a,previousPageUrl:d,nextPageUrl:u,nodes:s}}var we="cartFormInput";function x({children:e,action:t,inputs:r,route:n,fetcherKey:o}){let i=Re({key:o});return y.jsxs(i.Form,{action:n||"",method:"post",children:[(t||r)&&y.jsx("input",{type:"hidden",name:we,value:JSON.stringify({action:t,inputs:r})}),typeof e=="function"?e(i):e]})}x.INPUT_NAME=we;x.ACTIONS={AttributesUpdateInput:"AttributesUpdateInput",BuyerIdentityUpdate:"BuyerIdentityUpdate",Create:"Create",DiscountCodesUpdate:"DiscountCodesUpdate",LinesAdd:"LinesAdd",LinesRemove:"LinesRemove",LinesUpdate:"LinesUpdate",NoteUpdate:"NoteUpdate",SelectedDeliveryOptionsUpdate:"SelectedDeliveryOptionsUpdate",MetafieldsSet:"MetafieldsSet",MetafieldDelete:"MetafieldDelete"};function pt(e){let t={};for(let s of e.entries()){let a=s[0],c=e.getAll(a);t[a]=c.length>1?c:s[1]}let{cartFormInput:r,...n}=t,{action:o,inputs:i}=r?JSON.parse(String(r)):{};return{action:o,inputs:{...i,...n}}}x.getFormInput=pt;var Ie="__h_pending_";function ft(e){return Ie+e}function de(e){return e.startsWith(Ie)}function jt(e){let t=Oe();if(!t||!t.length)return e;let r=e!=null&&e.lines?structuredClone(e):{lines:{nodes:[]}},n=r.lines.nodes,o=!1;for(let{formData:i}of t){if(!i)continue;let s=x.getFormInput(i);if(s.action===x.ACTIONS.LinesAdd)for(let a of s.inputs.lines){if(!a.selectedVariant){console.error("[h2:error:useOptimisticCart] No selected variant was passed in the cart action. Make sure to pass the selected variant if you want to use an optimistic cart");continue}let c=n.find(d=>{var u;return d.merchandise.id===((u=a.selectedVariant)==null?void 0:u.id)});o=!0,c?(c.quantity=(c.quantity||1)+(a.quantity||1),c.isOptimistic=!0):n.unshift({id:ft(a.selectedVariant.id),merchandise:a.selectedVariant,isOptimistic:!0,quantity:a.quantity||1})}else if(s.action===x.ACTIONS.LinesRemove)for(let a of s.inputs.lineIds){let c=n.findIndex(d=>d.id===a);if(c!==-1){if(de(n[c].id)){console.error("[h2:error:useOptimisticCart] Tried to remove an optimistic line that has not been added to the cart yet");continue}n.splice(c,1),o=!0}else console.warn(`[h2:warn:useOptimisticCart] Tried to remove line '${a}' but it doesn't exist in the cart`)}else if(s.action===x.ACTIONS.LinesUpdate)for(let a of s.inputs.lines){let c=n.findIndex(d=>a.id===d.id);if(c>-1){if(de(n[c].id)){console.error("[h2:error:useOptimisticCart] Tried to update an optimistic line that has not been added to the cart yet");continue}n[c].quantity=a.quantity,n[c].quantity===0&&n.splice(c,1),o=!0}else console.warn(`[h2:warn:useOptimisticCart] Tried to update line '${a.id}' but it doesn't exist in the cart`)}}return o&&(r.isOptimistic=o),r}function Gt({handle:e,options:t=[],variants:r=[],productPath:n="products",children:o}){let i=r instanceof Array?r:R(r),{searchParams:s,path:a,alreadyOnProductPage:c}=ht(e,n),d=t.filter(u=>{var l;return((l=u==null?void 0:u.values)==null?void 0:l.length)===1});return p.createElement(p.Fragment,null,...p.useMemo(()=>t.filter(u=>{var l;return((l=u==null?void 0:u.values)==null?void 0:l.length)>1}).map(u=>{let l,m=[];for(let h of u.values){let f=new URLSearchParams(c?s:void 0);f.set(u.name,h),d.forEach(P=>{f.set(P.name,P.values[0])});let g=i.find(P=>{var V;return(V=P==null?void 0:P.selectedOptions)==null?void 0:V.every(D=>f.get(D==null?void 0:D.name)===(D==null?void 0:D.value))}),_=s.get(u.name),C=_?_===h:!1;C&&(l=h);let v="?"+f.toString();m.push({value:h,isAvailable:g?g.availableForSale:!0,to:a+v,search:v,isActive:C,variant:g})}return o({option:{name:u.name,value:l,values:m}})}),[t,i,o]))}function ht(e,t){let{pathname:r,search:n}=Q();return p.useMemo(()=>{let o=/(\/[a-zA-Z]{2}-[a-zA-Z]{2}\/)/g.exec(r),i=o&&o.length>0;t=t.startsWith("/")?t.substring(1):t;let s=i?`${o[0]}${t}/${e}`:`/${t}/${e}`;return{searchParams:new URLSearchParams(n),alreadyOnProductPage:s===r,path:s}},[r,n,e,t])}var Ae=p.createContext(void 0);Ae.Provider;var mt=()=>p.useContext(Ae);p.forwardRef((e,t)=>{let r=mt();return y.jsx("script",{suppressHydrationWarning:!0,...e,nonce:r,ref:t})});function U(e){let{type:t,data:r={},customData:n}=e,o=Q(),{publish:i,cart:s,prevCart:a,shop:c,customData:d}=X(),u=o.pathname+o.search,l={...r,customData:{...d,...n},cart:s,prevCart:a,shop:c};return p.useEffect(()=>{c!=null&&c.shopId&&(l={...l,url:window.location.href},i(t,l))},[i,u,c==null?void 0:c.shopId]),null}function gt(e){return y.jsx(U,{...e,type:"page_viewed"})}function yt(e){return y.jsx(U,{...e,type:"product_viewed"})}function vt(e){return y.jsx(U,{...e,type:"collection_viewed"})}function _t(e){return y.jsx(U,{...e,type:"cart_viewed"})}function Ct(e){return y.jsx(U,{...e,type:"search_viewed"})}function Pt(e){return y.jsx(U,{...e})}var M={PAGE_VIEWED:"page_viewed",PRODUCT_VIEWED:"product_viewed",COLLECTION_VIEWED:"collection_viewed",CART_VIEWED:"cart_viewed",SEARCH_VIEWED:"search_viewed",CART_UPDATED:"cart_updated",PRODUCT_ADD_TO_CART:"product_added_to_cart",PRODUCT_REMOVED_FROM_CART:"product_removed_from_cart",CUSTOM_EVENT:"custom_"},Et="https://cdn.shopify.com/shopifycloud/consent-tracking-api/v0.1/consent-tracking-api.js",wt="https://cdn.shopify.com/shopifycloud/privacy-banner/storefront-banner.js";function le(e){console.error(`[h2:error:useCustomerPrivacy] Unable to setup Customer Privacy API: Missing consent.${e} configuration.`)}function It(e){let{withPrivacyBanner:t=!0,onVisitorConsentCollected:r,onReady:n,...o}=e,i=p.useRef(!1),s=st(t?wt:Et,{attributes:{id:"customer-privacy-api"}});p.useEffect(()=>{let a=c=>{r&&r(c.detail)};return document.addEventListener("visitorConsentCollected",a),()=>{document.removeEventListener("visitorConsentCollected",a)}},[r]),p.useEffect(()=>{var m,h;if(s!=="done"||i.current)return;i.current=!0;let{checkoutDomain:a,storefrontAccessToken:c}=o;a||le("checkoutDomain"),c||le("storefrontAccessToken"),(c.startsWith("shpat_")||c.length!==32)&&console.error("[h2:error:useCustomerPrivacy] It looks like you passed a private access token, make sure to use the public token");let d={checkoutRootDomain:a,storefrontAccessToken:c};if(a){let f=window.document.location.host,g=a.split(".").reverse(),_=f.split(".").reverse(),C=[];g.forEach((v,P)=>{v===_[P]&&C.push(v)}),f=C.reverse().join("."),f&&(d.storefrontRootDomain=f)}if(t&&(window!=null&&window.privacyBanner)&&((m=window.privacyBanner)==null||m.loadBanner(d)),!((h=window.Shopify)!=null&&h.customerPrivacy))return;let u=window.Shopify.customerPrivacy.setTrackingConsent;function l(f,g){u({...f,headlessStorefront:!0,...d},g)}window.Shopify.customerPrivacy.setTrackingConsent=l,n&&n()},[s,t,o])}function At(){var e;try{return window.Shopify&&window.Shopify.customerPrivacy?(e=window.Shopify)==null?void 0:e.customerPrivacy:null}catch{return null}}function St(){let e=At();if(!e)throw new Error("Shopify Customer Privacy API not available. Must be used within a useEffect. Make sure to load the Shopify Customer Privacy API with useCustomerPrivacy() or <AnalyticsProvider>.");return e}function Tt({consent:e,onReady:t,domain:r}){let{subscribe:n,register:o,canTrack:i}=X(),[s,a]=p.useState(!1),[c,d]=p.useState(!1),{ready:u}=o("Internal_Shopify_Analytics"),{ready:l}=o("Internal_Shopify_CustomerPrivacy"),m=()=>{s&&c&&t()},h=()=>{d(!0),l(),m()},{checkoutDomain:f,storefrontAccessToken:g,withPrivacyBanner:_}=e;return It({checkoutDomain:f||"mock.shop",storefrontAccessToken:g||"abcdefghijklmnopqrstuvwxyz123456",withPrivacyBanner:_,onVisitorConsentCollected:h,onReady:()=>{setTimeout(h,3e3)}}),ut({hasUserConsent:s&&c?i():!0,domain:r,checkoutDomain:f}),p.useEffect(()=>{n(M.PAGE_VIEWED,bt),n(M.PRODUCT_VIEWED,xt),n(M.COLLECTION_VIEWED,Dt),n(M.SEARCH_VIEWED,Rt),n(M.PRODUCT_ADD_TO_CART,Ot),u(),a(!0),m()},[n,u]),null}function F(e){console.error(`[h2:error:ShopifyAnalytics] Unable to send Shopify analytics: Missing shop.${e} configuration.`)}function G(e){var n,o,i,s;let t=St(),r=t.analyticsProcessingAllowed();if(!((n=e==null?void 0:e.shop)!=null&&n.shopId)){F("shopId");return}if(!((o=e==null?void 0:e.shop)!=null&&o.acceptedLanguage)){F("acceptedLanguage");return}if(!((i=e==null?void 0:e.shop)!=null&&i.currency)){F("currency");return}if(!((s=e==null?void 0:e.shop)!=null&&s.hydrogenSubchannelId)){F("hydrogenSubchannelId");return}return{shopifySalesChannel:"hydrogen",...e.shop,hasUserConsent:r,...tt(),ccpaEnforced:!t.saleOfDataAllowed(),gdprEnforced:!(t.marketingAllowed()&&t.analyticsProcessingAllowed())}}function kt(e,t){if(t===null)return;let r=G(e);return r?{...r,cartId:t.id}:void 0}var k={};function bt(e){let t=G(e);t&&(j({eventName:E.PAGE_VIEW_2,payload:{...t,...k}}),k={})}function xt(e){let t=G(e);if(t&&Se({type:"product",products:e.products})){let r=K(e.products);k={pageType:N.product,resourceId:r[0].productGid},t={...t,...k,products:K(e.products)},j({eventName:E.PRODUCT_VIEW,payload:t})}}function Dt(e){let t=G(e);t&&(k={pageType:N.collection,resourceId:e.collection.id},t={...t,...k,collectionHandle:e.collection.handle},j({eventName:E.COLLECTION_VIEW,payload:t}))}function Rt(e){let t=G(e);t&&(k={pageType:N.search},t={...t,...k,searchString:e.searchTerm},j({eventName:E.SEARCH_VIEW,payload:t}))}function Ot(e){let{cart:t,currentLine:r}=e,n=kt(e,t);!n||!(r!=null&&r.id)||Lt({matchedLine:r,eventPayload:n})}function Lt({matchedLine:e,eventPayload:t}){let r={id:e.merchandise.product.id,variantId:e.id,title:e.merchandise.product.title,variantTitle:e.merchandise.title,vendor:e.merchandise.product.vendor,price:e.merchandise.price.amount,quantity:e.quantity,productType:e.merchandise.product.productType,sku:e.merchandise.sku};Se({type:"cart",products:[r]})&&j({eventName:E.ADD_TO_CART,payload:{...t,products:K([r])}})}function b(e,t,r,n){if(e==="cart"){let o=`${r?"merchandise":"merchandise.product"}.${t}`;console.error(`[h2:error:ShopifyAnalytics] Can't set up cart analytics events because the \`cart.lines[].${o}\` value is missing from your GraphQL cart query. In your project, search for where \`fragment CartLine on CartLine\` is defined and make sure \`${o}\` is part of your cart query. Check the Hydrogen Skeleton template for reference: https://github.com/Shopify/hydrogen/blob/main/templates/skeleton/app/lib/fragments.ts#L25-L56.`)}else{let o=`${n||t}`;console.error(`[h2:error:ShopifyAnalytics] Can't set up product view analytics events because the \`${o}\` is missing from your \`<Analytics.ProductView>\`. Make sure \`${o}\` is part of your products data prop. Check the Hydrogen Skeleton template for reference: https://github.com/Shopify/hydrogen/blob/main/templates/skeleton/app/routes/products.%24handle.tsx#L159-L165.`)}}function Se({type:e,products:t}){return!t||t.length===0?(b(e,"",!1,"data.products"),!1):(t.forEach(r=>{if(!r.id)return b(e,"id",!1),!1;if(!r.title)return b(e,"title",!1),!1;if(!r.price)return b(e,"price.amount",!0,"price"),!1;if(!r.vendor)return b(e,"vendor",!1),!1;if(!r.variantId)return b(e,"id",!0,"variantId"),!1;if(!r.variantTitle)return b(e,"title",!0,"variantTitle"),!1}),!0)}function K(e){return e.map(t=>{let r={productGid:t.id,variantGid:t.variantId,name:t.title,variantName:t.variantTitle,brand:t.vendor,price:t.price,quantity:t.quantity||1,category:t.productType};return t.sku&&(r.sku=t.sku),t.productType&&(r.category=t.productType),r})}function pe(e){console.error(`[h2:error:CartAnalytics] Can't set up cart analytics events because the \`cart.${e}\` value is missing from your GraphQL cart query. In your project, search for where \`fragment CartApiQuery on Cart\` is defined and make sure \`${e}\` is part of your cart query. Check the Hydrogen Skeleton template for reference: https://github.com/Shopify/hydrogen/blob/main/templates/skeleton/app/lib/fragments.ts#L59.`)}function Nt({cart:e,setCarts:t}){let{publish:r,shop:n,customData:o,canTrack:i,cart:s,prevCart:a}=X(),c=p.useRef(null);return p.useEffect(()=>{if(e)return Promise.resolve(e).then(d=>{if(d&&d.lines){if(!d.id){pe("id");return}if(!d.updatedAt){pe("updatedAt");return}}t(({cart:u,prevCart:l})=>(d==null?void 0:d.updatedAt)!==(u==null?void 0:u.updatedAt)?{cart:d,prevCart:u}:{cart:u,prevCart:l})}),()=>{}},[t,e]),p.useEffect(()=>{if(!s||!(s!=null&&s.updatedAt)||(s==null?void 0:s.updatedAt)===(a==null?void 0:a.updatedAt))return;let d;try{d=JSON.parse(localStorage.getItem("cartLastUpdatedAt")||"")}catch{d=null}if(s.id===(d==null?void 0:d.id)&&s.updatedAt===(d==null?void 0:d.updatedAt))return;let u={eventTimestamp:Date.now(),cart:s,prevCart:a,shop:n,customData:o};if(s.updatedAt===c.current)return;c.current=s.updatedAt,r("cart_updated",u),localStorage.setItem("cartLastUpdatedAt",JSON.stringify({id:s.id,updatedAt:s.updatedAt}));let l=a!=null&&a.lines?R(a==null?void 0:a.lines):[],m=s.lines?R(s.lines):[];l==null||l.forEach(h=>{let f=m.filter(g=>h.id===g.id);if((f==null?void 0:f.length)===1){let g=f[0];h.quantity<g.quantity?r("product_added_to_cart",{...u,prevLine:h,currentLine:g}):h.quantity>g.quantity&&r("product_removed_from_cart",{...u,prevLine:h,currentLine:g})}else r("product_removed_from_cart",{...u,prevLine:h})}),m==null||m.forEach(h=>{let f=l.filter(g=>h.id===g.id);(!f||f.length===0)&&r("product_added_to_cart",{...u,currentLine:h})})},[s,a,r,n,o,i]),null}var Ut={canTrack:()=>!1,cart:null,customData:{},prevCart:null,publish:()=>{},shop:null,subscribe:()=>{},register:()=>({ready:()=>{}})},Te=p.createContext(Ut),J=new Map,q={};function ke(){return Object.values(q).every(Boolean)}function fe(e,t){var r;J.has(e)||J.set(e,new Map),(r=J.get(e))==null||r.set(t.toString(),t)}var Y=new Map;function he(e,t){if(!ke()){Y.set(e,t);return}be(e,t)}function be(e,t){(J.get(e)??new Map).forEach((r,n)=>{try{r(t)}catch(o){typeof o=="object"&&o instanceof Error?console.error("Analytics publish error",o.message,n,o.stack):console.error("Analytics publish error",o,n)}})}function me(e){return q.hasOwnProperty(e)||(q[e]=!1),{ready:()=>{q[e]=!0,ke()&&Y.size>0&&(Y.forEach((t,r)=>{be(r,t)}),Y.clear())}}}function ge(){try{return window.Shopify.customerPrivacy.analyticsProcessingAllowed()}catch{}return!1}function ye(e,t){return`[h2:error:Analytics.Provider] - ${e} is required. Make sure ${t} is defined in your environment variables. See https://h2o.fyi/analytics/consent to learn how to setup environment variables in the Shopify admin.`}function Vt({canTrack:e,cart:t,children:r,consent:n,customData:o={},shop:i=null,disableThrowOnError:s=!1,cookieDomain:a}){var C;let c=p.useRef(!1),{shop:d}=$t(i),[u,l]=p.useState(!!e),[m,h]=p.useState({cart:null,prevCart:null}),[f,g]=p.useState(e?()=>e:()=>ge);if(d)if(/\/68817551382$/.test(d.shopId))dt("[h2:error:Analytics.Provider] - Mock shop is used. Analytics will not work properly.");else{if(!n.checkoutDomain){let v=ye("consent.checkoutDomain","PUBLIC_CHECKOUT_DOMAIN");ue(v)}if(!n.storefrontAccessToken){let v=ye("consent.storefrontAccessToken","PUBLIC_STOREFRONT_API_TOKEN");ue(v)}}let _=p.useMemo(()=>({canTrack:f,...m,customData:o,publish:f()?he:()=>{},shop:d,subscribe:fe,register:me}),[u,f(),f,JSON.stringify(f),m,(C=m.cart)==null?void 0:C.updatedAt,m.prevCart,he,fe,o,d,me,JSON.stringify(q)]);return y.jsxs(Te.Provider,{value:_,children:[r,!!d&&y.jsx(gt,{}),!!d&&!!t&&y.jsx(Nt,{cart:t,setCarts:h}),!!d&&n.checkoutDomain&&y.jsx(Tt,{consent:n,onReady:()=>{c.current=!0,l(!0),g(()=>ge)},domain:a})]})}function X(){let e=p.useContext(Te);if(!e)throw new Error("[h2:error:useAnalytics] 'useAnalytics()' must be a descendent of <AnalyticsProvider/>");return e}function $t(e){let[t,r]=p.useState(null);return p.useEffect(()=>(Promise.resolve(e).then(r),()=>{}),[r,e]),{shop:t}}var Ht={CartView:_t,CollectionView:vt,CustomView:Pt,ProductView:yt,Provider:Vt,SearchView:Ct};export{x as G,X,mt as a,R as f,Ht as l,Gt as m,jt as p,Wt as w};
