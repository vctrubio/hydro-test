import{r as d,j as e}from"./jsx-runtime-BMrMXMSG.js";import{w as g}from"./index-C5AQyKIf.js";import{F as v,L as o,f as R,g as f}from"./components-BcnCSsUz.js";import{I as x}from"./Image-4ZSXy-qP.js";import{M as j}from"./Money-ivyePXta.js";function y(r,s){return s?r!=null&&r.trackingParameters?`?${s}&${r.trackingParameters}`:`?${s}`:r!=null&&r.trackingParameters?`?${r.trackingParameters}`:""}const S=[{type:"queries",items:[]},{type:"products",items:[]},{type:"collections",items:[]},{type:"pages",items:[]},{type:"articles",items:[]}];function A({searchTerm:r}){const s=d.useRef(null);return d.useEffect(()=>{function t(n){var c,a;n.key==="k"&&n.metaKey&&(n.preventDefault(),(c=s.current)==null||c.focus()),n.key==="Escape"&&((a=s.current)==null||a.blur())}return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[]),e.jsxs(v,{method:"get",children:[e.jsx("input",{defaultValue:r,name:"q",placeholder:"Search…",ref:s,type:"search"})," ",e.jsx("button",{type:"submit",children:"Search"})]})}function D({results:r,searchTerm:s}){if(!r)return null;const t=Object.keys(r);return e.jsx("div",{children:r&&t.map(n=>{var a,i,l;const c=r[n];if(((a=c.nodes[0])==null?void 0:a.__typename)==="Page"){const u=c;return c.nodes.length?e.jsx(k,{pages:u},"pages"):null}if(((i=c.nodes[0])==null?void 0:i.__typename)==="Product"){const u=c;return c.nodes.length?e.jsx(P,{products:u,searchTerm:s},"products"):null}if(((l=c.nodes[0])==null?void 0:l.__typename)==="Article"){const u=c;return c.nodes.length?e.jsx(E,{articles:u},"articles"):null}return null})})}function P({products:r,searchTerm:s}){return e.jsxs("div",{className:"search-result",children:[e.jsx("h2",{children:"Products"}),e.jsx(g,{connection:r,children:({nodes:t,isLoading:n,NextLink:c,PreviousLink:a})=>{const i=t.map(l=>{const u=y(l,`q=${encodeURIComponent(s)}`);return e.jsx("div",{className:"search-results-item",children:e.jsxs(o,{prefetch:"intent",to:`/products/${l.handle}${u}`,children:[l.variants.nodes[0].image&&e.jsx(x,{data:l.variants.nodes[0].image,alt:l.title,width:50}),e.jsxs("div",{children:[e.jsx("p",{children:l.title}),e.jsx("small",{children:e.jsx(j,{data:l.variants.nodes[0].price})})]})]})},l.id)});return e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(a,{children:n?"Loading...":e.jsx("span",{children:"↑ Load previous"})})}),e.jsxs("div",{children:[i,e.jsx("br",{})]}),e.jsx("div",{children:e.jsx(c,{children:n?"Loading...":e.jsx("span",{children:"Load more ↓"})})})]})}}),e.jsx("br",{})]})}function k({pages:r}){var s;return e.jsxs("div",{className:"search-result",children:[e.jsx("h2",{children:"Pages"}),e.jsx("div",{children:(s=r==null?void 0:r.nodes)==null?void 0:s.map(t=>e.jsx("div",{className:"search-results-item",children:e.jsx(o,{prefetch:"intent",to:`/pages/${t.handle}`,children:t.title})},t.id))}),e.jsx("br",{})]})}function E({articles:r}){var s;return e.jsxs("div",{className:"search-result",children:[e.jsx("h2",{children:"Articles"}),e.jsx("div",{children:(s=r==null?void 0:r.nodes)==null?void 0:s.map(t=>e.jsx("div",{className:"search-results-item",children:e.jsx(o,{prefetch:"intent",to:`/blogs/${t.handle}`,children:t.title})},t.id))}),e.jsx("br",{})]})}function G(){return e.jsx("p",{children:"No results, try a different search."})}function O({action:r,children:s,className:t="predictive-search-form",...n}){const c=R(),a=f({key:"search"}),i=d.useRef(null);function l(u){const h=r??"/api/predictive-search",m=u.target.value||"",p=c.locale?`/${c.locale}${h}`:h;a.submit({q:m,limit:"6"},{method:"GET",action:p})}return d.useEffect(()=>{var u;(u=i==null?void 0:i.current)==null||u.setAttribute("type","search")},[]),e.jsx(a.Form,{...n,className:t,onSubmit:u=>{u.preventDefault(),u.stopPropagation(),!(!(i!=null&&i.current)||i.current.value==="")&&i.current.blur()},children:s({fetchResults:l,inputRef:i,fetcher:a})})}function U(){const{results:r,totalResults:s,searchInputRef:t,searchTerm:n,state:c}=$();function a(i){t.current&&(t.current.blur(),t.current.value="",window.location.href=i.currentTarget.href)}return c==="loading"?e.jsx("div",{children:"Loading..."}):s?e.jsxs("div",{className:"predictive-search-results",children:[e.jsx("div",{children:r.map(({type:i,items:l})=>e.jsx(T,{goToSearchResult:a,items:l,searchTerm:n,type:i},i))}),n.current&&e.jsx(o,{onClick:a,to:`/search?q=${n.current}`,children:e.jsxs("p",{children:["View all results for ",e.jsx("q",{children:n.current}),"  →"]})})]}):e.jsx(N,{searchTerm:n})}function N({searchTerm:r}){return r.current?e.jsxs("p",{children:["No results found for ",e.jsx("q",{children:r.current})]}):null}function T({goToSearchResult:r,items:s,searchTerm:t,type:n}){const c=n==="queries",a=`/search?q=${t.current}&type=${L(n)}`;return e.jsxs("div",{className:"predictive-search-result",children:[e.jsx(o,{prefetch:"intent",to:a,onClick:r,children:e.jsx("h5",{children:c?"Suggestions":n})}),e.jsx("ul",{children:s.map(i=>e.jsx(b,{goToSearchResult:r,item:i},i.id))})]},n)}function b({goToSearchResult:r,item:s}){var t;return e.jsx("li",{className:"predictive-search-result-item",children:e.jsxs(o,{onClick:r,to:s.url,children:[((t=s.image)==null?void 0:t.url)&&e.jsx(x,{alt:s.image.altText??"",src:s.image.url,width:50,height:50}),e.jsxs("div",{children:[s.styledTitle?e.jsx("div",{dangerouslySetInnerHTML:{__html:s.styledTitle}}):e.jsx("span",{children:s.title}),(s==null?void 0:s.price)&&e.jsx("small",{children:e.jsx(j,{data:s.price})})]})]})},s.id)}function $(){var c,a;const r=f({key:"search"}),s=d.useRef(""),t=d.useRef(null);(r==null?void 0:r.state)==="loading"&&(s.current=((c=r.formData)==null?void 0:c.get("q"))||"");const n=((a=r==null?void 0:r.data)==null?void 0:a.searchResults)||{results:S,totalResults:0};return d.useEffect(()=>{t.current||(t.current=document.querySelector('input[type="search"]'))},[]),{...n,searchInputRef:t,searchTerm:s,state:r.state}}function L(r){const s={articles:"ARTICLE",collections:"COLLECTION",pages:"PAGE",products:"PRODUCT",queries:"QUERY"};return typeof r=="string"?s[r]:r.map(t=>s[t]).join(",")}export{G as N,O as P,A as S,D as a,U as b};
